# This is a basic workflow to help you get started with Actions

name: Marlin Build

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the 2.0.x branch
on:
  push:
    branches: [ 2.0.x ]
    paths-ignore:
    - config/**
    - data/**
    - docs/**
    - '**/*.md'
  pull_request:
    branches: [ 2.0.x ]
    paths-ignore:
    - config/**
    - data/**
    - docs/**
    - '**/*.md'

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    if: github.repository == 'kfrancis/Marlin'
    
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Select Python 3.7
      uses: actions/setup-python@v1
      with:
        python-version: '3.7' # Version range or exact version of a Python version to use, using semvers version range syntax.
        architecture: 'x64' # optional x64 or x86. Defaults to x64 if not specified

    - name: Install PlatformIO
      run: |
        pip install -U https://github.com/platformio/platformio-core/archive/develop.zip
        platformio update
          
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
      
    # SKR14
    - name: PlatformIO build for LPC1768
      run: pio run --environment=LPC1768
      
    - uses: actions/upload-artifact@v2
      name: SKR14 Artifact
      with:
        name: skr14_firmware
        path: ${{ github.workspace }}/.pio/build/LPC1768/firmware.bin

    # SKR14 Turbo
    - name: PlatformIO build for LPC1769
      run: pio run --environment=LPC1769
      
    - uses: actions/upload-artifact@v2
      name: SKR14 Turbo Artifact
      with:
        name: skr14turbo_firmware
        path: ${{ github.workspace }}/.pio/build/LPC1769/firmware.bin
